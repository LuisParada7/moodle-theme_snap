{"version":3,"file":"snap_feeds.min.js","sources":["../src/snap_feeds.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @copyright Copyright (c) 2024 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Snap feeds side menu.\n */\ndefine(['jquery', 'core/log','theme_snap/util', 'theme_snap/ajax_notification'],\n    function($, log, util, ajaxNotify) {\n        /**\n         * Load Snap feeds content when advanced feeds are disabled.\n         *\n         */\n        var update = function() {\n            $(document).ready(function() {\n                var loadAjaxInfo = function(type) {\n                    // Target for data to be displayed on screen.\n                    var container = $('#snap-feeds-menu-' + type);\n                    if ($(container).length) {\n                        var cacheKey = M.cfg.sesskey + 'snap-feeds-menu-' + type;\n                        try {\n                            // Display old content while waiting\n                            if (util.supportsSessionStorage() && window.sessionStorage[cacheKey]) {\n                                log.info('using locally stored ' + type);\n                                var html = window.sessionStorage[cacheKey];\n                                $(container).html(html);\n                            }\n                            log.info('fetching ' + type);\n                            $.ajax({\n                                type: \"GET\",\n                                async: true,\n                                url: M.cfg.wwwroot + '/theme/snap/rest.php?action=get_' + type + '&contextid=' + M.cfg.context,\n                                success: function(data) {\n                                    ajaxNotify.ifErrorShowBestMsg(data).done(function(errorShown) {\n                                        if (errorShown) {\n                                            return;\n                                        } else {\n                                            // No errors, update sesion storage.\n                                            log.info('fetched ' + type);\n                                            if (util.supportsSessionStorage() && typeof (data.html) != 'undefined') {\n                                                window.sessionStorage[cacheKey] = data.html;\n                                            }\n                                            // Note: we can't use .data because that does not manipulate the dom, we need the data\n                                            // attribute populated immediately so things like behat can utilise it.\n                                            // .data just sets the value in memory, not the dom.\n                                            $(container).attr('data-content-loaded', '1');\n                                            $(container).html(data.html);\n                                        }\n                                    });\n                                }\n                            });\n                        } catch (err) {\n                            sessionStorage.clear();\n                            log.error(err);\n                        }\n                    }\n                };\n\n                loadAjaxInfo('deadlines');\n                loadAjaxInfo('graded');\n                loadAjaxInfo('grading');\n                loadAjaxInfo('messages');\n                loadAjaxInfo('forumposts');\n            });\n        };\n\n        /**\n         * Apply Snap feeds side menu listeners.\n         */\n        var applyListeners = function() {\n            // On clicking snap feeds side menu trigger.\n            $(document).on(\"click\", \".js-snap-feeds-side-menu-trigger\", function(event) {\n                if ($('#snap_feeds_side_menu').is(':visible')) {\n                    update();\n                }\n                event.preventDefault();\n\n            });\n        };\n\n        var init = function() {\n            applyListeners();\n        };\n\n        return {\n            init: init,\n        };\n    }\n);"],"names":["define","$","log","util","ajaxNotify","applyListeners","document","on","event","is","ready","loadAjaxInfo","type","container","length","cacheKey","M","cfg","sesskey","supportsSessionStorage","window","sessionStorage","info","html","ajax","async","url","wwwroot","context","success","data","ifErrorShowBestMsg","done","errorShown","attr","err","clear","error","preventDefault","init"],"mappings":";;;;;;;;;;;;;;;;;;;;AAwBAA,+BAAO,CAAC,SAAU,WAAW,kBAAmB,iCAC5C,SAASC,EAAGC,IAAKC,KAAMC,gBA6DfC,eAAiB,WAEjBJ,EAAEK,UAAUC,GAAG,QAAS,oCAAoC,SAASC,OAC7DP,EAAE,yBAAyBQ,GAAG,aA1DtCR,EAAEK,UAAUI,OAAM,eACVC,aAAe,SAASC,UAEpBC,UAAYZ,EAAE,oBAAsBW,SACpCX,EAAEY,WAAWC,OAAQ,KACjBC,SAAWC,EAAEC,IAAIC,QAAU,mBAAqBN,YAG5CT,KAAKgB,0BAA4BC,OAAOC,eAAeN,UAAW,CAClEb,IAAIoB,KAAK,wBAA0BV,UAC/BW,KAAOH,OAAOC,eAAeN,UACjCd,EAAEY,WAAWU,KAAKA,MAEtBrB,IAAIoB,KAAK,YAAcV,MACvBX,EAAEuB,KAAK,CACHZ,KAAM,MACNa,OAAO,EACPC,IAAKV,EAAEC,IAAIU,QAAU,mCAAqCf,KAAO,cAAgBI,EAAEC,IAAIW,QACvFC,QAAS,SAASC,MACd1B,WAAW2B,mBAAmBD,MAAME,MAAK,SAASC,YAC1CA,aAIA/B,IAAIoB,KAAK,WAAaV,MAClBT,KAAKgB,+BAAkD,IAAdW,KAAKP,OAC9CH,OAAOC,eAAeN,UAAYe,KAAKP,MAK3CtB,EAAEY,WAAWqB,KAAK,sBAAuB,KACzCjC,EAAEY,WAAWU,KAAKO,KAAKP,aAKzC,MAAOY,KACLd,eAAee,QACflC,IAAImC,MAAMF,QAKtBxB,aAAa,aACbA,aAAa,UACbA,aAAa,WACbA,aAAa,YACbA,aAAa,iBAabH,MAAM8B,2BASP,CACHC,KALO,WACPlC"}